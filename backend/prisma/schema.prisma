// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String        @map("password_hash")
  fullName     String        @map("full_name")
  role         String        @default("admin") // admin, manager, staff
  isActive     Boolean       @default(true) @map("is_active")
  lastLogin    DateTime?     @map("last_login")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  
  transactions Transaction[]

  @@index([email])
  @@map("users")
}

model Category {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  icon        String? // Lucide React icon name
  color       String? // Hex color code
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  
  products    Product[]

  @@index([name])
  @@index([isActive])
  @@map("categories")
}

model Product {
  id          String            @id @default(uuid())
  categoryId  String            @map("category_id")
  name        String
  description String?
  sku         String            @unique
  price       Decimal           @db.Decimal(12, 2)
  cost        Decimal?          @db.Decimal(12, 2)
  stock       Int               @default(0)
  minStock    Int               @default(5) @map("min_stock")
  imageUrl    String?           @map("image_url")
  barcode     String?
  isActive    Boolean           @default(true) @map("is_active")
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  
  category         Category          @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  transactionItems TransactionItem[]

  @@index([categoryId])
  @@index([sku])
  @@index([name])
  @@index([isActive])
  @@index([stock])
  @@map("products")
}

model Customer {
  id             String        @id @default(uuid())
  name           String
  email          String?       @unique
  phone          String?
  address        String?
  totalPurchases Decimal       @default(0) @db.Decimal(12, 2) @map("total_purchases")
  isActive       Boolean       @default(true) @map("is_active")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  
  transactions Transaction[]

  @@index([email])
  @@index([phone])
  @@map("customers")
}

model Transaction {
  id                String            @id @default(uuid())
  transactionNumber String            @unique @map("transaction_number")
  customerId        String?           @map("customer_id")
  userId            String            @map("user_id")
  subtotal          Decimal           @db.Decimal(12, 2)
  tax               Decimal           @default(0) @db.Decimal(12, 2)
  discount          Decimal           @default(0) @db.Decimal(12, 2)
  total             Decimal           @db.Decimal(12, 2)
  paymentMethod     PaymentMethod     @default(cash) @map("payment_method")
  paymentStatus     PaymentStatus     @default(paid) @map("payment_status")
  notes             String?
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  
  customer Customer?         @relation(fields: [customerId], references: [id], onDelete: SetNull)
  user     User              @relation(fields: [userId], references: [id])
  items    TransactionItem[]

  @@index([transactionNumber])
  @@index([customerId])
  @@index([userId])
  @@index([createdAt])
  @@index([paymentStatus])
  @@map("transactions")
}

model TransactionItem {
  id            String      @id @default(uuid())
  transactionId String      @map("transaction_id")
  productId     String      @map("product_id")
  productName   String      @map("product_name")
  productSku    String      @map("product_sku")
  quantity      Int
  unitPrice     Decimal     @db.Decimal(10, 2) @map("unit_price")
  subtotal      Decimal     @db.Decimal(12, 2)
  createdAt     DateTime    @default(now()) @map("created_at")
  
  transaction Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  product     Product     @relation(fields: [productId], references: [id])

  @@index([transactionId])
  @@index([productId])
  @@map("transaction_items")
}

enum PaymentMethod {
  cash
  debit_card
  credit_card
  digital_wallet
  bank_transfer
}

enum PaymentStatus {
  pending
  paid
  refunded
  cancelled
}
